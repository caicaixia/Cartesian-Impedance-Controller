<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>workspace: README.md Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Cartesian Impedance Controller</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;[![CI](https://github.com/matthias-mayr/Cartesian-Impedance-Controller/actions/workflows/build_code.yml/badge.svg?branch=master)](https://github.com/matthias-mayr/Cartesian-Impedance-Controller/actions/workflows/build_code.yml)  [![rosdoc](https://github.com/matthias-mayr/Cartesian-Impedance-Controller/actions/workflows/build_docs.yml/badge.svg)](https://matthias-mayr.github.io/Cartesian-Impedance-Controller/)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;## Description</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;This project is an implementation of Cartesian impedance control for robotic manipulators. It is a type of control strategy that sets a dynamic relationship between contact forces and the position of a robot arm, making it suitable for collaborative robots. It is particularily useful when the interesting dimensions in the workspace are in the Cartesian space.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The controller is developed using the seven degree-of-freedom (DoF) robot arm `LBR iiwa` by `KUKA AG` and has also been tested with the `Franka Emika Robot (Panda)` both in reality and simulation.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The implementation consists of a</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;1. base library that has few dependencies and can e.g. be directly integrated into software such as the DART simulator and a</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;2. ROS control integration on top of it.</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;### Short Pitch at ROSCon:</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;[![IMAGE ALT TEXT](http://img.youtube.com/vi/Q4aPm4O_9fY/0.jpg)](http://www.youtube.com/watch?v=Q4aPm4O_9fY &quot;Cartesian Impedance Controller ROSCon 2022 Lightning Talk&quot;)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;http://www.youtube.com/watch?v=Q4aPm4O_9fY</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;## Features</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;- Configurable stiffness values along all Cartesian dimensions at runtime</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;- Configurable damping factors along all Cartesian dimensions at runtime</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;- Change reference pose at runtime</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;- Apply Cartesian forces and torques at runtime</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;- Optional filtering of stiffnesses, pose and wrenches for smoother operation</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;- Handling of joint trajectories with nullspace configurations, e.g. from MoveIt</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;- Jerk limitation</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;- Separate base library that can be integrated in non-ROS environments</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;- Interface to ROS messages and dynamic_reconfigure for easy runtime configuration</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;![](./res/flowchart.png)</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;## Torques</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;The torque signal commanded to the joints of the robot is composed by the superposition of three joint-torque signals:</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;- The torque calculated for Cartesian impedance control with respect to a Cartesian pose reference in the frame of the EE of the robot (`tau_task`).</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;- The torque calculated for joint impedance control with respect to a desired configuration and projected in the nullspace of the robot&#39;s Jacobian, so it should not affect the Cartesian motion of the robot&#39;s end-effector (`tau_ns`).</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;- The torque necessary to achieve the desired external force command (`cartesian_wrench`), in the frame of the EE of the robot (`tau_ext`).</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;## Limitations</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;- Joint friction is not accounted for</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;- Stiffness and damping values along the Cartesian dimensions are uncoupled</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;- No built-in gravity compensation for tools or workpieces (can be achieved by commanding a wrench)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;## Prerequisites</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;### Required</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;- [Eigen](https://eigen.tuxfamily.org/index.php?title=Main_Page)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;### ROS Controller</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;We use `RBDyn` to calculate forward kinematics and the Jacobian.</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;- [ROS](https://www.ros.org/)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;- [RBDyn](https://github.com/jrl-umi3218/RBDyn)</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;- [mc_rbdyn_urdf](https://github.com/jrl-umi3218/mc_rbdyn_urdf)</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;- [SpaceVecAlg](https://github.com/jrl-umi3218/SpaceVecAlg)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;The installation steps for the installation of the non-ROS dependencies are automated in `scripts/install_dependencies.sh`.</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;## Controller Usage in ROS</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;Assuming that there is an [initialized catkin workspace](https://catkin-tools.readthedocs.io/en/latest/quick_start.html#initializing-a-new-workspace) you can clone this repository, install the dependencies and compile the controller.</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;Here are the steps:</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;```bash</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;cd catkin_ws</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;git clone https://github.com/matthias-mayr/Cartesian-Impedance-Controller src/Cartesian-Impedance-Controller</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;src/Cartesian-Impedance-Controller/scripts/install_dependencies.sh</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;rosdep install --from-paths src --ignore-src --rosdistro=${ROS_DISTRO} -y</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;catkin build # or catkin_make</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;source devel/setup.bash</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;```</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;This allows you to add a controller configuration for the controller type `cartesian_impedance_controller/CartesianImpedanceController` in your `ros_control` configuration.</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;### Configuration file</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;When using the controller it is a good practice to describe the parameters in a `YAML` file and load it. Usually this is already done by your robot setup - e.g. for [iiwa_ros](https://github.com/epfl-lasa/iiwa_ros/) that is [here](https://github.com/epfl-lasa/iiwa_ros/blob/master/iiwa_control/config/iiwa_control.yaml).</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;Here is a template of what needs to be in that YAML file that can be adapted:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;```YAML</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;CartesianImpedance_trajectory_controller:</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  type: cartesian_impedance_controller/CartesianImpedanceController</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  joints:                               # Joints to control</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    - iiwa_joint_1</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    - iiwa_joint_2</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    - iiwa_joint_3</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    - iiwa_joint_4</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    - iiwa_joint_5</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    - iiwa_joint_6</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    - iiwa_joint_7</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  end_effector: iiwa_link_ee            # Link to control arm in</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  update_frequency: 500                 # Controller update frequency in Hz</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  # Optional parameters - the mentioned values are the defaults</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  dynamic_reconfigure: true             # Starts dynamic reconfigure server</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  handle_trajectories: true             # Accept traj., e.g. from MoveIt</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  robot_description: /robot_description # In case of a varying name</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  wrench_ee_frame: iiwa_link_ee         # Default frame for wrench commands</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  delta_tau_max: 1.0                    # Max. commanded torque diff between steps in Nm</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  filtering:                            # Update existing values (0.0 1.0] per s</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    nullspace_config: 0.1               # Nullspace configuration filtering</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    pose: 0.1                           # Reference pose filtering</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    stiffness: 0.1                      # Cartesian and nullspace stiffness</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    wrench: 0.1                         # Commanded torque</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  verbosity:</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    verbose_print: false                # Enables additional prints</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    state_msgs: false                   # Messages of controller state</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    tf_frames: false                    # Extra tf frames</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;```</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;### Startup</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;To start up with this controller, eventually the controller spawner needs to load the controller. Typically this is baked into the robot driver. For example if using the YAML example above, with [iiwa_ros](https://github.com/epfl-lasa/iiwa_ros/), this can be achieved with command:</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;```bash</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;roslaunch iiwa_gazebo iiwa_gazebo.launch controller:=CartesianImpedance_trajectory_controller</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;```</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;### Changing parameters with Dynamic Reconfigure</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;If it is not deactivated, the controller can be configured with [dynamic_reconfigure](http://wiki.ros.org/dynamic_reconfigure) both with [command line tools](http://wiki.ros.org/dynamic_reconfigure#dynamic_reconfigure.2Fgroovy.dynparam_command-line_tool) as well as the graphical user interface [rqt_reconfigure](http://wiki.ros.org/rqt_reconfigure). To start the latter you can run:</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;```bash</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;rosrun rqt_reconfigure rqt_reconfigure</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;```</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;There are several entries:</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;- `cartesian_wrench_reconfigure`</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;- `damping_factors_reconfigure`</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;- `stiffness_reconfigure`</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;For applying wrench, the `apply` checkbox needs to be ticked for the values to be used. Damping and stiffness changes are only updated when the `update` checkbox is ticked, allowing to configure changes before applying them. Note that the end-effector reference pose can not be set since it usually should follow a smooth trajectory.</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;### Changing parameters with ROS messages</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;In addition to the configuration with `dynamic_reconfigure`, the controller configuration can always be adapted by sending ROS messages. Outside prototyping this is the main way to parameterize it.</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;The instructions below use `${controller_ns}` for the namespace of your controller. This can for example be `/cartesian_impedance_controller`. If you want to copy the example commands 1:1, you can set an environment variable with `export controller_ns=/&lt;your_namespace&gt;`.</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;#### End-effector reference pose</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;New reference poses can be sent to the topic `${controller_ns}/reference_pose`. They are expected to be in the root frame of the robot description which is often `world`. The root frame can be obtained from the parameter server with `rosparam get ${controller_ns}/root_frame`.</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;To send a new reference pose 0.6m above the root frame pointing into the z-direction of it, execute this:</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;```bash</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;rostopic pub --once /${controller_ns}/reference_pose geometry_msgs/PoseStamped &quot;header:</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  seq: 0</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  stamp:</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    secs: 0</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    nsecs: 0</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  frame_id: &#39;&#39;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;pose:</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  position:</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    x: 0.0</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    y: 0.0</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    z: 0.6</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  orientation:</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    x: 0.0</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    y: 0.0</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    z: 0.0</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    w: 1.0&quot;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;```</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;Most often one wants to have a controlled way to set reference poses. Once can for example use a [trajectory generator for Cartesian trajectories](https://git.cs.lth.se/robotlab/cartesian_trajectory_generator).</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;#### Cartesian Stiffness</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;In order to set only the Cartesian stiffnesses, once can send a `geometry_msgs/WrenchStamped` to `set_cartesian_stiffness`:</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;```bash</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;rostopic pub --once /${controller_ns}/set_cartesian_stiffness geometry_msgs/WrenchStamped &quot;header:</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  seq: 0</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  stamp:</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    secs: 0</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    nsecs: 0</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  frame_id: &#39;&#39;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;wrench:</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  force:</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    x: 300.0</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    y: 300.0</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    z: 300.0</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  torque:</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    x: 30.0</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    y: 30.0</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    z: 30.0&quot;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;```</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;#### Cartesian Damping factors</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;The damping factors can be configured with a `geometry_msgs/WrenchStamped` msg similar to the stiffnesses to the topic `${controller_ns}/set_damping_factors`. Damping factors are in the interval [0.01,1].</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;#### Stiffnesses, damping and nullspace at once</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;When also setting the nullspace stiffnes, a custom messages of the type `cartesian_impedance_controller/ControllerConfig` is to be sent to `set_config`:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;```bash</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;rostopic pub --once /${controller_ns}/set_config cartesian_impedance_controller/ControllerConfig &quot;cartesian_stiffness:</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  force: {x: 300.0, y: 300.0, z: 300.0}</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  torque: {x: 30.0, y: 30.0, z: 30.0}</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;cartesian_damping:</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  force: {x: 0.0, y: 0.0, z: 0.0}</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  torque: {x: 0.0, y: 0.0, z: 0.0}</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;nullspace_stiffness: 10.0</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;nullspace_damping: 0.1</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;q_d_nullspace: [0, 0, 0, 0, 0, 0, 0]&quot; </div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;```</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;`q_d_nullspace` is the nullspace joint configuration, so the joint configuration that should be achieved if the nullspace allows it. Note that the end-effector pose would deviate if the forward kinematics of this joint configuration do not overlap with it.</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;#### Cartesian Wrenches</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;A Cartesian wrench can be commanded by sending a `geometry_msgs/WrenchStamped` to the topic `${controller_ns}/set_cartesian_wrench`.</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;Internally the wrenches are applied in the root frame. Therefore wrench messages are transformed into the root frame using `tf`.&lt;br&gt;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;**Note:** An empty field `frame_id` is interpreted as end-effector frame since this is the most applicable one when working with a manipulator.&lt;br&gt;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;**Note:** The wrenches are transformed into the root frame when they arrive, but not after that. E.g. end-effector wrenches might need to get updated.</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;```bash</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;rostopic pub --once /${controller_ns}/set_cartesian_wrench geometry_msgs/WrenchStamped &quot;header:</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  seq: 0</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  stamp:</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    secs: 0</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    nsecs: 0</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  frame_id: &#39;&#39;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;wrench:</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  force:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    x: 0.0</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    y: 0.0</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    z: 5.0</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  torque:</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    x: 0.0</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    y: 0.0</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    z: 0.0&quot;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;```</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;### Trajectories and MoveIt</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;If `handle_trajectories` is not disabled, the controller can also execute trajectories. An action server is spun up at `${controller_ns}/follow_joint_trajectory` and a fire-and-forget topic for the message type `trajectory_msgs/JointTrajectory` is at `${controller_ns}/joint_trajectory`.</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;In order to use it with `MoveIt` its controller configuration ([example in iiwa_ros](https://github.com/epfl-lasa/iiwa_ros/blob/master/iiwa_moveit/config/EffortJointInterface_controllers.yaml)) needs to look somewhat like this:</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;```yaml</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;controller_list:</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  - name: ${controller_ns}</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    action_ns: follow_joint_trajectory</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    type: FollowJointTrajectory</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    default: true</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    joints:</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      - iiwa_joint_1</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      - iiwa_joint_2</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      - iiwa_joint_3</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      - iiwa_joint_4</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      - iiwa_joint_5</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      - iiwa_joint_6</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      - iiwa_joint_7</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;```</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;**Note:** A nullspace stiffness needs to be specified so that the arm also follows the joint configuration and not just the end-effector pose.</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;## Safety</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;We have used the controller with Cartesian translational stiffnesses of up to 1000 N/m and experienced it as very stable. It is also stable in singularities.</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;One additional measure can be to limit the maximum joint torques that can be applied by the robot arm in the URDF. On our KUKA iiwas we limit the maximum torque of each joint to 20 Nm, which allows a human operator to easily interfere at any time just by grabbing the arm and moving it.</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;When using `iiwa_ros`, these limits can be applied [here](https://github.com/epfl-lasa/iiwa_ros/blob/master/iiwa_description/urdf/iiwa7.xacro#L53-L59). For the Panda they are applied [here](https://github.com/frankaemika/franka_ros/blob/develop/franka_description/robots/panda/joint_limits.yaml#L6). Both arms automatically apply gravity compensation, the limits are only used for the task-level torques on top of that.</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;## Documentation</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;The source code comes with Doxygen documentation. In a `catkin` workspace it can be built with:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;```bash</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;sudo apt-get install ros-$ROS_DISTRO-rosdoc-lite</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;roscd cartesian_impedance_controller</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;rosdoc_lite .</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;```</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;It can then be found in the `doc` folder with `doc/html/index.html` being the entry point.</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;The documentation for the public Github repository is automatically built and is deployed at:&lt;br&gt;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;https://matthias-mayr.github.io/Cartesian-Impedance-Controller/</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;## Repository and Contributions</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;The main public code repository is at: https://github.com/matthias-mayr/Cartesian-Impedance-Controller</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;Issues, questions and pull requests are welcome. Feel free to contact the main author at `firstname.lastname@cs.lth.se` if you are using this implementation.</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;## Citing this Work</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;A brief paper about the features and the control theory is under submission at [JOSS](https://joss.theoj.org/). For now there is a [preprint on arXiv](https://arxiv.org/abs/2212.11215).&lt;br&gt;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;If you are using it or interacting with it, we would be happy if you could cite it.</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;```bibtex</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;@misc{https://doi.org/10.48550/arxiv.2212.11215,</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  doi = {10.48550/ARXIV.2212.11215},</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  url = {https://arxiv.org/abs/2212.11215},</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  author = {Mayr, Matthias and Salt-Ducaju, Julian M.},</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  keywords = {Robotics (cs.RO), FOS: Computer and information sciences, FOS: Computer and information sciences},</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  title = {A C++ Implementation of a Cartesian Impedance Controller for Robotic Manipulators},</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  publisher = {arXiv},</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  year = {2022}, </div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  copyright = {Creative Commons Attribution Share Alike 4.0 International}</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;```</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;## Troubleshooting</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;### Compilation - A required package was not found</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;catkin build shows this CMake Error:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;```</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;CMake Error at /usr/share/cmake-3.16/Modules/FindPkgConfig.cmake:463 (message):</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  A required package was not found</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;Call Stack (most recent call first):</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  /usr/share/cmake-3.16/Modules/FindPkgConfig.cmake:643 (_pkg_check_modules_internal)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  CMakeLists.txt:12 (pkg_check_modules)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;```</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;There are missing dependencies. When replacing `catkin_ws` with your workspace, they can be resolved like this :</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;```</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;cd catkin_ws</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;src/cartesian_impedance_controller/scripts/install_dependencies.sh</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;rosdep install --from-paths src --ignore-src --rosdistro=${ROS_DISTRO} -y</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/workspace">workspace</a><br />
Author(s): Matthias Mayr, Oussama Chouman</br />
<small>autogenerated on Fri Dec 23 2022 14:59:42</small>
</div>
</body>
</html>
